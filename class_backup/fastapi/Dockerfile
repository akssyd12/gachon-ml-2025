# --------------------------------------------------------
# Python 3.11 경량 이미지 기반 (FastAPI는 Python 3.11 이상 권장)
# --------------------------------------------------------
FROM python:3.11-slim

# --------------------------------------------------------
# 컨테이너 내 작업 디렉토리 설정
# 모든 명령이 /app 폴더 기준으로 실행됨
# --------------------------------------------------------
WORKDIR /app

# --------------------------------------------------------
# Python 패키지 의존성 파일 복사 및 설치
# (requirements.txt는 호스트에서 컨테이너로 복사됨)
# --------------------------------------------------------
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# --------------------------------------------------------
# 코드 파일은 COPY 하지 않음
# (차후 docker run 시 volume 바인딩 마운트로 연결할 예정)
# 예: -v ~/fastapi/user:/app
# --------------------------------------------------------
# COPY . .

# --------------------------------------------------------
# FastAPI 환경 변수 (선택)
# Flask와 달리 FastAPI는 ENV 설정이 필수는 아님
# --------------------------------------------------------
ENV FASTAPI_APP=main.py
ENV FASTAPI_HOST=0.0.0.0

# --------------------------------------------------------
# 컨테이너 외부로 80포트 노출
# uvicorn이 내부 80포트로 서비스하게 설정함
# --------------------------------------------------------
EXPOSE 80

# --------------------------------------------------------
# FastAPI 애플리케이션 실행
# Flask의 "flask run"과 달리 uvicorn을 직접 실행
# --------------------------------------------------------
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "80"]
