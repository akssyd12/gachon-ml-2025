<?php

// redis_session.php 안에는 session_set_save_handler() 설정 코드가 있음
include_once("./redis_session.php"); // 세션을 Redis로 저장하도록 핸들러 등록

// -----------------------------------------------------------
// ① session_start()
// -----------------------------------------------------------
// 1) PHP가 클라이언트의 쿠키에서 PHPSESSID 값을 읽음
//    - 없으면 새로 생성 (예: "8f94e2b78e3d1e1a2c4f7b99c8a5e6f2")
// 2) 등록된 핸들러의 open($save_path, $session_name) 자동 호출
// 3) 이어서 read($session_id) 호출 → Redis에서 "session:<세션ID>" 데이터 조회
//    - 이전 세션 데이터가 있으면 읽고, 없으면 빈 세션으로 시작
session_start();

// -----------------------------------------------------------
// ② $_SESSION 배열에 데이터 저장
// -----------------------------------------------------------
// PHP 내부 메모리상의 세션 배열에 값만 기록됨
// 이 시점에는 아직 Redis에 반영되지 않음
$_SESSION['username'] = "홍길동";
$_SESSION['userid'] = "kky";

// -----------------------------------------------------------
// ③ 세션 데이터 사용
// -----------------------------------------------------------
// 현재 메모리에 로드된 $_SESSION 값을 바로 출력 가능
// 브라우저 출력 시 PHPSESSID 쿠키도 함께 전송되어
// 다음 요청에서 동일한 세션을 복원할 수 있음
echo "사용자 이름 : {$_SESSION['username']}<br>";
echo "사용자 아이디 : {$_SESSION['userid']}<br>";

// -----------------------------------------------------------
// ④ 스크립트 종료 시 자동 호출 (핸들러 내부 동작)
// -----------------------------------------------------------
// - write($session_id, $session_data) 호출
//   → PHP가 $_SESSION 배열을 직렬화하여 Redis에 저장
//   → 예: setex("session:8f94e2b78e3d1e1a2c4f7b99c8a5e6f2", 3600, 'username|s:9:"홍길동";userid|s:3:"kky";')
// - close() 호출
//   → 세션 저장 완료 후 종료 처리

?>